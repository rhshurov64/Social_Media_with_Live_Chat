{% extends 'base/base.html' %}


{% block content %}
<div class="container mt-3">
    <div class="row">
        <div class="row" style="overflow: hidden;">
                
            <!-- go back button -->
            <button style="width: 140px; margin-bottom:10px;" class="btn btn-sm btn-outline-primary" onclick="history.back()"><i class="fa-solid fa-arrow-left"></i> Go Back</button>
            {% for p in posts %}


            <div class="bootstrap snippets bootdey" style="overflow: hidden;">
                <div class="col">
                    <div class="panel panel-white post panel-shadow" style="overflow: hidden;">
                        <div class="post-heading mt-3 ms-2">
                            <div class="row image prob">
                                <div class="col-1">
                                    <img src="{{p.authorprofile.profileimg.url}}" class="img-circle avatar"
                                        alt="user profile image">
                                </div>
                                <div class="col">
                                    <div class="row">
                                        <div class="col-10">
                                            <div class="title h5">
                                                <a href="{% url 'profile' p.authorprofile.user.id %}" class=""><b>{{p.author.get_full_name}}</b></a>
                                            </div>
                                        </div>


                                        {% if request.user.id == p.author.id or request.user.is_staff == True %}



                                        <div class="col-2">
                                            <div class="postedit">
                                                <a class="me-3" href="{% url 'postedit' p.id %}" title="Edit">
                                                    <i class="fa-regular fa-pen-to-square fa-xs"></i>
                                                </a>
                                                <a href="/postdelete?post_id={{p.id}}" title="Delete">
                                                    <i class="fa-solid fa-trash fa-xs"></i>
                                                </a>

                                            </div>
                                        </div>
                                        {% endif %}

                                    </div>

                                    <h6 class="text-muted time">{{p.updated_at}}</h6>
                                </div>

                            </div>

                        </div>
                        <div class="post-description">
                            <p>{{p.text}}</p>

                            {% if p.postimg %}
                            <img style="height: 400px; width:auto;" src="{{ p.postimg.url }}" alt="">


                            {% endif %}

                            <div class="">

                                <div class="my-4 flex space-x-4 lg:font-bold" style="display: inline;">

                                    <a href="/like?post_id={{p.id}}" class="flex items-center space-x-2" style="display: inline;">
                                        <div class="rounded-full text-black" style="display: inline;">

                                            <!-- love icon START-->
                                            <i class="fa-regular fa-heart fa-lg mt-4" id="love" style="color: #c82828;"></i>
                                            <!-- love icon ENd-->

                                            {% if p.total_like >= 1 %}
                                            

                                            {% endif %}
                                        </div>                                           
                                    </a>
                                    <h6 class="ms-3" style="display: inline;">{{p.total_like}}</h6>

                                    <i class="fa-regular fa-comment fa-lg  ms-5"></i>
                                    <h6 class="ms-3" style="display: inline;">{{p.total_comment}}</h6>
                                    
                                </div>
                                {% if p.postimg %}
                                        
                                    <a style="margin-left: 50px;" title="Download" href="{% url 'download_image' p.id %}" download><i class="fa-solid fa-download fa-lg"></i></a>

                                {% endif %}
                            </div>
                        </div>
                        <div class="post-footer">

                            <!-- comment start -->
                            <form action="/comment/{{p.id}}" method="POST">{% csrf_token %}
                                <div class="input-group">
                                    <input class="form-control" name="comment" placeholder="Add a comment" type="text" required>
                                    <span class="input-group-addon">
                                        <a href="{% url 'comment' p.id %}"><button class="btn btn-success px-2" type="submit" id="button-addon2"><i class="fa-regular fa-paper-plane"></i> Comment</button></a>
                                        

                                    </span>
                                </div>
                            </form>

                            
                            {% for cmnt in comments %}                      
                            
                            <ul class="comments-list">
                                <li class="comment">
                                    <a class="pull-left" href="#">
                                        <img class="avatar" src="{{cmnt.authorprofile.profileimg.url}}" alt="avatar">
                                    </a>
                                    
                                    
                                    <div class="comment-body">
                                        <div class="comment-heading">
                                            <h4 class="user">{{cmnt.author.get_full_name}}</h4>
                                            <h5 class="time">{{cmnt.created_at}}</h5>
                                        </div>

                                         <!-- edit delete -->
                                        {% if request.user.id == cmnt.author.id or request.user.is_staff == True %}
                                        <div class="postedit">
                                           
                                            <a class="me-3" href="{% url 'commentedit' cmnt.id %}" title="Edit">
                                                <i class="fa-regular fa-pen-to-square fa-xs"></i>
                                            </a>
                                            
                                            <a href="/comment_delete?cmnt_id={{cmnt.id}}&post_id= {{p.id}}" title="Delete">
                                                <i class="fa-solid fa-trash fa-xs"></i>
                                            </a>

                                           
                                           

                                        </div>
                                        {% endif %}
                                        <p>{{cmnt.text}}</p>
                                        
                                        



                                        
                                    </div>

                                    
                                    
                                    <a href="{% url 'show_replay' p.id cmnt.id  %}"><p data-bs-toggle="collapse" data-bs-target="#demo{{cmnt.id}}">Replay</p></a>
                                    <hr>

                                    
                                    <!-- <ul class="comments-list">
                                        <hr>
                                        
                                        <a href="{% url 'show_replay' cmnt.id p.id %}"><p data-bs-toggle="collapse" data-bs-target="#demo{{cmnt.id}}">Replay</p></a>

                                        <div id="demo{{cmnt.id}}" class="collapse">

                                            {% for replay in replay %}
                                            <li class="comment">
                                                <a class="pull-left" href="#">
                                                    <img class="avatar" src="https://bootdey.com/img/Content/user_3.jpg" alt="avatar">
                                                </a>
                                                <div class="comment-body">
                                                    <div class="comment-heading">
                                                        <h4 class="user">Ryan Haywood</h4>
                                                        <h5 class="time">3 minutes ago</h5>
                                                    </div>
                                                    <p>{{replay.replay}}</p>
                                                </div>
                                            </li> 

                                            {% endfor %}
    

                                            <form action="/show_comment/{{p.id}}/" method="POST">{% csrf_token %}
                                            <li class="comment">
                                                <div class="input-group">
                                                    <input class="form-control" name="replay" placeholder="Add a comment" type="text">
                                                    <input type="hidden" name="cmnt_id" value="{{cmnt.id}}">
                                                    <span class="input-group-addon">
                                                        <button class="btn btn-success px-2" type="submit" id="button-addon2"><i class="fa-regular fa-paper-plane"></i> Replay</button>
                
                                                    </span>
                                                </div>
                                            </li> 
                                            </form>
                                        
                                        </div>

                                        
                                    </ul> -->



                                        
                                    
                                </li>
                            </ul>

                            {% endfor %}
                           
                        </div>
                        <!-- comment end -->
                    </div>
                </div>
            </div>

            {% endfor %}
        </div>
    </div>
 </div>


  
  

{% endblock content %}
    

